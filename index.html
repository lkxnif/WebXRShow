---
layout: default
title: WebXR Demo
description: A simple WebXR demonstration using A-Frame
---
<!DOCTYPE html>
<html>
<head>
  <title>{{ page.title }}</title>
  <!-- Pico设备所需的meta标签 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="pico-vr-content" content="true">
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <style>
    #debug-info {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      font-family: monospace;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="debug-info">等待XR初始化...</div>
  
  <a-scene 
    webxr="requiredFeatures: local-floor; 
           optionalFeatures: dom-overlay, bounded-floor, camera-access; 
           overlayElement: #overlay;
           referenceSpaceType: local-floor;"
    vr-mode-ui="enabled: true"
    device-orientation-permission-ui="enabled: true"
    renderer="colorManagement: true;">
    
    <!-- VR模式专用内容 -->
    <a-entity id="vr-content">
      <a-box position="0 1.6 -2" rotation="0 45 0" color="#4CC3D9" class="interactive"></a-box>
      <a-sphere position="2 1.6 -2" radius="0.5" color="#FFC65D" class="interactive"></a-sphere>
      <!-- VR模式下的天空盒 -->
      <a-sky id="vr-sky" color="#ECECEC"></a-sky>
    </a-entity>

    <!-- AR模式专用内容 -->
    <a-entity id="ar-content">
      <a-box position="0 0.5 -1" rotation="0 45 0" scale="0.5 0.5 0.5" color="#4CC3D9"></a-box>
      <a-sphere position="1 0.5 -1" radius="0.25" color="#FFC65D"></a-sphere>
    </a-entity>

    <!-- 通用内容 -->
    <a-plane position="0 0 -2" rotation="-90 0 0" width="10" height="10" color="#7BC8A4" visible="false" id="ground"></a-plane>
    
    <!-- AR模式的hit-test标记 -->
    <a-entity id="hit-test-marker" visible="false">
      <a-circle radius="0.1" rotation="-90 0 0" material="color: red; opacity: 0.5"></a-circle>
    </a-entity>
    
    <!-- VR控制器 -->
    <a-entity id="leftHand" laser-controls="hand: left" raycaster="objects: .interactive"></a-entity>
    <a-entity id="rightHand" laser-controls="hand: right" raycaster="objects: .interactive"></a-entity>

    <!-- 相机实体 -->
    <a-entity id="camera" camera position="0 1.6 0" look-controls wasd-controls></a-entity>
  </a-scene>

  <!-- UI覆盖层 -->
  <div id="overlay" style="position: fixed; bottom: 20px; width: 100%; text-align: center; z-index: 999;">
    <button id="place-button" style="display: none; padding: 10px 20px; font-size: 16px;">放置物体</button>
    <div id="mode-indicator" style="color: white; background: rgba(0,0,0,0.5); padding: 5px; margin-top: 10px;"></div>
  </div>

  <script>
    window.addEventListener('load', function () {
      const scene = document.querySelector('a-scene');
      const marker = document.querySelector('#hit-test-marker');
      const placeButton = document.querySelector('#place-button');
      const modeIndicator = document.querySelector('#mode-indicator');
      const vrContent = document.querySelector('#vr-content');
      const arContent = document.querySelector('#ar-content');
      const debugInfo = document.querySelector('#debug-info');
      const ground = document.querySelector('#ground');
      const vrSky = document.querySelector('#vr-sky');
      
      // 检测XR支持
      if (navigator.xr) {
        debugInfo.textContent = '检测XR支持...';
        
        // 检测VR支持
        navigator.xr.isSessionSupported('immersive-vr')
          .then((supported) => {
            if (supported) {
              debugInfo.textContent += '\nVR模式支持';
              modeIndicator.textContent = 'VR模式可用';
            } else {
              debugInfo.textContent += '\nVR模式不支持';
            }
          })
          .catch(err => {
            debugInfo.textContent += '\nVR检测错误: ' + err;
          });
          
        // 检测AR支持
        navigator.xr.isSessionSupported('immersive-ar')
          .then((supported) => {
            if (supported) {
              debugInfo.textContent += '\nAR模式支持';
            } else {
              debugInfo.textContent += '\nAR模式不支持';
            }
          })
          .catch(err => {
            debugInfo.textContent += '\nAR检测错误: ' + err;
          });
      } else {
        debugInfo.textContent = 'WebXR不支持';
      }

      // 场景加载完成时
      scene.addEventListener('loaded', function () {
        debugInfo.textContent += '\n场景已加载';
      });

      // 会话开始时的处���
      scene.addEventListener('enter-vr', function () {
        debugInfo.textContent += '\n尝试进入XR模式';
        
        if (scene.is('ar-mode')) {
          debugInfo.textContent += '\n进入AR模式';
          modeIndicator.textContent = 'AR模式';
          marker.setAttribute('visible', 'true');
          placeButton.style.display = 'block';
          vrContent.setAttribute('visible', 'false');
          arContent.setAttribute('visible', 'true');
          ground.setAttribute('visible', 'false');
          vrSky.setAttribute('visible', 'false');
        } else {
          debugInfo.textContent += '\n进入VR模式';
          modeIndicator.textContent = 'VR模式';
          marker.setAttribute('visible', 'false');
          placeButton.style.display = 'none';
          vrContent.setAttribute('visible', 'true');
          arContent.setAttribute('visible', 'false');
          ground.setAttribute('visible', 'true');
          vrSky.setAttribute('visible', 'true');
        }
      });

      // 退出XR时的处理
      scene.addEventListener('exit-vr', function () {
        debugInfo.textContent += '\n退出XR模式';
        modeIndicator.textContent = '普通模式';
        marker.setAttribute('visible', 'false');
        placeButton.style.display = 'none';
        vrContent.setAttribute('visible', 'true');
        arContent.setAttribute('visible', 'true');
        ground.setAttribute('visible', 'true');
        vrSky.setAttribute('visible', 'true');
      });

      // 错误处理
      scene.addEventListener('loaded', function () {
        const webxrManager = scene.systems.webxr;
        webxrManager.addEventListener('sessionerror', function (evt) {
          debugInfo.textContent += '\nXR会话错误: ' + evt.error;
        });
      });
    });
  </script>
</body>
</html>
<!-- ctrl + alt +i打开网页后，快捷键打开aframe inspector --> 